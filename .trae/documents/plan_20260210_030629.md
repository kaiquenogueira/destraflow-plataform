O plano a seguir detalha as alterações para implementar o campo `evolutionPhone` na interface administrativa e remover o processamento de mensagens recebidas pelo webhook da aplicação, delegando essa responsabilidade para sua automação de IA.

### 1. Implementação do Campo `evolutionPhone` (Admin)

Adicionar o campo para cadastro do número do agente na tela de edição de usuários.

* **Frontend (`src/components/admin/user-form.tsx`)**:

  * Adicionar `evolutionPhone` ao estado do formulário e à interface de props.

  * Incluir um novo campo de Input "Número do WhatsApp (Agente)" na seção de configuração da Evolution API.

* **Backend (`src/actions/admin.ts`)**:

  * Atualizar os schemas Zod (`createUserSchema` e `updateUserSchema`) para aceitar `evolutionPhone` (opcional).

  * Atualizar a função `getUserById` para retornar o campo `evolutionPhone`.

  * Atualizar as funções `createUser` e `updateUser` para salvar o dado no banco (será mantido como texto simples, não criptografado, para facilitar a leitura no worker).

### 2. Ajuste do Webhook da Aplicação Ainda preciso que o `chat_histories seja criado no momento do envio da mensagem para que fique registrado qual o tamplate foi enviado e automacao sera responsavel pora atualiza a tabela leads.`

Remover a responsabilidade de registrar mensagens recebidas, já que a automação de IA fará isso.

* **Arquivo** **`src/lib/evolution-webhook.ts`**:

  * Remover a lógica dentro de `handleMessageUpsert` que cria registros em `chat_histories`.

  * Manter apenas o processamento de **Status de Entrega** (`messages.update`) e **Status de Conexão** (`connection.update`), se necessário, ou desativar completamente o evento `MESSAGES_UPSERT`.

  * *Ação:* Comentar ou remover o bloco que processa mensagens recebidas para evitar duplicidade com sua automação.

### 3. Instruções para Automação de IA (Atualização do CRM)

Para que o CRM seja atualizado corretamente quando sua automação registrar o retorno do cliente, sua automação (n8n, Typebot, etc.) deve realizar as seguintes operações no banco de dados do tenant:

1. **Registrar a Mensagem (`chat_histories`)**:

   * Tabela: `chat_histories`

   * Campos obrigatórios:

     * `user_id`: ID do contato na tabela `users` (buscar pelo telefone).

     * `session_id`: `{{telefone_cliente}}_{{telefone_agente}}`

     * `thread_id`: Gerar um ID único (ex: timestamp).

     * `message`: JSON com conteúdo `{"type": "incoming", "content": "texto..."}`.

2. **Atualizar o Lead (`leads`)**:

   * Tabela: `leads`

   * Ação: Atualizar o campo `updated_at` para o timestamp atual (`NOW()`).

   * *Motivo:* Isso fará com que o lead suba para o topo da lista de atendimentos recentes no CRM.

***

**Confirmação:**
Você autoriza a execução das alterações nos arquivos `src/components/admin/user-form.tsx`, `src/actions/admin.ts` e `src/lib/evolution-webhook.ts` conforme descrito acima?
